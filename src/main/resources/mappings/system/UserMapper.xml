<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.root.cognition.system.dao.UserDao">


    <!--UserRole实体类方法-->
    <select id="getWithRole" parameterType="string" resultType="com.root.cognition.system.domain.UserRoleDo">
        SELECT
          su.user_id   AS "user.id",
          su.user_name AS "user.userName",
          su.user_password AS "user.userPassword",
          su.user_email AS "user.userEmail",
          su.user_mobile AS "user.userMobile",
          sr.role_id	  AS "role.id",
          sr.role_name AS "role.roleName",
          sr.role_sign AS "role.roleSign",
          sr.role_
        FROM sys_user su
        LEFT JOIN user_role_info uri ON  su.user_id = uri.user_id
        LEFT JOIN sys_role sr ON uri ON  sr.role_id = uri.role_id
        WHERE a.id = #{id}
    </select>


    <!--////////***************基础方法*******************///////-->

    <!-- 根据id获得用户 -->
    <select id="get" parameterType="string" resultType="com.root.cognition.system.dao.UserDao">
        SELECT
        <include refid="userColumns"/>
        FROM sys_user a
        WHERE a.user_id = #{id}
    </select>

    <!--获取的条件都是user表里的唯一值-->
    <select id="getByEntity" parameterType="com.root.cognition.system.dao.UserDao"
            resultType="com.root.cognition.system.dao.UserDao">
        SELECT
        <include refid="userColumns"/>
        FROM sys_user a
        <where>
            a.del_flag = #{DEL_FLAG_NORMAL}
            <if test="id !=null and id !=''">
                AND a.user_id = #{id}
            </if>
            <if test="userName !=null and userName !=''">
                AND a.user_name = #{userName}
            </if>
            <if test="userEmail !=null and userEmail!=''">
                AND a.user_email = #{userEmail}
            </if>
            <if test="userMobile !=null and userMobile!=''">
                AND a.user_mobile = #{userMobile}
            </if>
        </where>
    </select>

    <!--多条查询用户信息 -->
    <select id="findList" resultType="com.root.cognition.system.dao.UserDao">
        SELECT
        <include refid="userColumns"/>
        FROM sys_user a
        <where>
            a.del_flag = #{DEL_FLAG_NORMAL}
            <if test="id !=null and id !=''">
                AND a.user_id = #{id}
            </if>
            <if test="userName !=null and userName !=''">
                AND a.user_name = #{userName}
            </if>
        </where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
            <otherwise>
                order by id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <!--查询用户数目 -->
    <select id="count" resultType="int">
        select count(*) from sys_user
    </select>

    <!-- 插入用户 -->
    <insert id="insert">
        INSERT INTO sys_user(
        `user_id`,
        `user_name`,
        `user_password`,
        <if test="userEmail !=null and userEmail !=''">
            `user_email`,
        </if>
        <if test="userMobile !=null and userMobile !=''">
            `user_mobile`,
        </if>
        `create_by`,
        `create_time`,
        `update_by`,
        `update_time`,
        `del_flage`
        ) VALUES (
        #{id},
            #{userName},
            #{userPassword},
        <if test="userEmail !=null and userEmail !=''">
            #{userEmail},
        </if>
        <if test="userMobile !=null and userMobile !=''">
            #{userMobile},
        </if>
        #{createBy},
            #{gmtCreate},
            #{updater},
            #{gmtModified},
            #{delFlage}
        )
    </insert>

    <!-- 更新用户 -->
    <update id="update">
        UPDATE sys_user SET
        `user_id` = #{id},
        `user_name` = #{userName},
        `user_password` = #{userPassword},
        <if test="userEmail !=null and userEmail !=''">
            `user_email` = #{userEmail},
        </if>
        <if test="userMobile !=null and userMobile !=''">
            `user_mobile` = #{userMobile},
        </if>
        `create_by` = #{createBy},
        `create_time` = #{createTime},
        `update_by` = #{updateBy},
        `updateTime` = #{updateTime},
        `del_flage` = #{delFlage}
        WHERE id = #{id}
    </update>

    <sql id="userColumns">
          a.user_id   AS "id",
          a.user_name AS "userName",
          a.user_password AS "userPassword",
          a.user_email AS "userEmail",
          a.user_mobile AS "userMobile",
          a.creator AS "creator",
          a.create_time AS "createTime",
          a.updater AS "updater",
          a.update_time AS "updateTime",
          a.del_flage AS "delFlage"
    </sql>

</mapper>